<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* global Slate*/
Ext.define(&#39;SlateTasksTeacher.view.TaskEditor&#39;, {
    extend: &#39;Slate.cbl.view.modals.CreateTask&#39;,
    xtype: &#39;slate-tasks-teacher-taskeditor&#39;,


    config: {
        task: null,
        studentTask: null
    },


    // config handlers
    updateStudentTask: function(studentTask) {
        var me = this,
            assignmentsfield = me.down(&#39;slate-tasks-assignmentsfield&#39;),
            assignmentsfieldCheckbox = assignmentsfield.down(&#39;checkboxfield&#39;),
            titleField = me.down(&#39;slate-tasks-titlefield&#39;),
            parentTaskField = titleField.next(&#39;slate-tasks-titlefield&#39;),
            experienceField = me.down(&#39;#experience-type&#39;),
            duedateField = me.down(&#39;#duedate&#39;),
            expirationdateField = me.down(&#39;#expirationdate&#39;),
            skillsField = me.down(&#39;slate-skillsfield&#39;),
            attachmentsfield = me.down(&#39;slate-tasks-attachmentsfield&#39;),
            instructionsField = me.down(&#39;#instructions&#39;),
            taskPrivacyField = me.down(&#39;#status&#39;);

        if (studentTask) {
            // move to controller?
            if (assignmentsfieldCheckbox) {
                assignmentsfieldCheckbox.destroy();
            }

            me.insert(0, assignmentsfield);

            // hide &amp; disable fields
            assignmentsfield.down(&#39;combo&#39;).setReadOnly(true);
            titleField.setReadOnly(true);
            parentTaskField.setReadOnly(true);
            experienceField.setReadOnly(true);
            instructionsField.setReadOnly(true);
            attachmentsfield.setReadOnly(true);

            skillsField.setSkills(studentTask.get(&#39;Skills&#39;) || [], true, true); // append, editable

            taskPrivacyField.setDisabled(true);

            assignmentsfield.down(&#39;combo&#39;).setValue(studentTask.get(&#39;StudentID&#39;));

            // override fields
            if (duedateField &amp;&amp; studentTask.get(&#39;DueDate&#39;)) {
                duedateField.setValue(studentTask.get(&#39;DueDate&#39;), &#39;m/d/Y&#39;);
            }

            if (expirationdateField &amp;&amp; studentTask.get(&#39;ExpirationDate&#39;)) {
                expirationdateField.setValue(studentTask.get(&#39;ExpirationDate&#39;), &#39;m/d/Y&#39;);
            }
        }
    },

    updateTask: function(task) {
        var me = this,
            form = me.down(&#39;slate-modalform&#39;),
            skillsField = form.down(&#39;slate-skillsfield&#39;),
            attachmentsField = form.down(&#39;slate-tasks-attachmentsfield&#39;),
            assignmentsField = me.down(&#39;slate-tasks-assignmentsfield&#39;),
            taskPrivacyField = me.down(&#39;#status&#39;), taskStatus,
            parentTaskField, parentTaskStore;

        form.reset();
        if (task) {
            form.loadRecord(task);
            skillsField.setSkills(task.get(&#39;Skills&#39;), false, false); // append, editable
            attachmentsField.setAttachments(task.get(&#39;Attachments&#39;));
            assignmentsField.setAssignees(task.getAssigneeIds());

            me.setTitle((task.phantom ? &#39;Create&#39; : &#39;Edit&#39;) + &#39; Task&#39;);
            me.down(&#39;button[action=save]&#39;).setText(task.phantom ? &#39;Publish&#39; : &#39;Save&#39;);

            if (task.get(&#39;ParentTaskID&#39;)) {
                parentTaskField = form.down(&#39;slate-tasks-titlefield[name=ParentTaskID]&#39;);
                parentTaskStore = parentTaskField.getStore();
                // load parent task if store does not contain the record
                if (!parentTaskStore.getById(task.get(&#39;ParentTaskID&#39;))) {
                    parentTaskStore.load({
                        url: Slate.API.buildUrl(&#39;/cbl/tasks/&#39;+task.get(&#39;ParentTaskID&#39;)),
                        params: {
                            summary: true
                        },
                        addRecords: true,
                        callback: function () {
                            parentTaskField.setValue(task.get(&#39;ParentTaskID&#39;));
                        }
                    });
                }
            }

            if (task.get(&#39;Status&#39;) === &#39;shared&#39;) {
                taskStatus = &#39;shared&#39;;
            } else if (task.get(&#39;Status&#39;) === &#39;private&#39;) {
                taskStatus = false;
            }
        }

        taskPrivacyField.setValue(taskStatus);
    }
});</pre>
</body>
</html>

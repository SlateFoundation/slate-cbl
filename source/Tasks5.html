<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;SlateTasksStudent.store.Tasks&#39;, {
    extend: &#39;Ext.data.Store&#39;,


    model: &#39;SlateTasksStudent.model.Task&#39;,

    config: {
        student: null,
        section: null,

        pageSize: 0,
        remoteSort: false,

        sorters: [{
            sorterFn: function(task1, task2) {
                var completed1 = task1.get(&#39;TaskStatus&#39;) == &#39;completed&#39;,
                    completed2 = task2.get(&#39;TaskStatus&#39;) == &#39;completed&#39;,
                    date1 = task1.get(&#39;DueDate&#39;),
                    date2 = task2.get(&#39;DueDate&#39;),
                    submitted1, submitted2;

                // completed tasks are obsolute last
                // TODO: sort within completed?
                if (completed1 &amp;&amp; completed2) {
                    submitted1 = task1.get(&#39;Submitted&#39;) || date1;
                    submitted2 = task2.get(&#39;Submitted&#39;) || date2;

                    if (!submitted1) {
                        return 1;
                    }

                    if (!submitted2) {
                        return -1;
                    }

                    return submitted1 &gt; submitted2 ? -1 : submitted1.getTime() == submitted2.getTime() ? 0 : 1;
                } else if (completed1) {
                    return 1;
                } else if (completed2) {
                    return -1;
                }

                // tasks without due date are second to last
                if (date1 === null) {
                    return 1;
                } else if (date2 === null) {
                    return -1;
                }

                // finally sort by oldest due date first
                return date1 &gt; date2 ? 1 : date1.getTime() == date2.getTime() ? 0 : -1;
            }
        }],

        // redeclare identical proxy as model for dynamic reconfiguration
        proxy: {
            type: &#39;slate-cbl-studenttasks&#39;,
            url: &#39;/cbl/student-tasks/assigned&#39;,
            include: [
                &#39;Submitted&#39;,
                &#39;Student&#39;,
                &#39;Section&#39;,
                &#39;Comments&#39;,
                &#39;Attachments.File&#39;,
                &#39;Submissions&#39;,
                &#39;TaskSkills&#39;,
                &#39;Task.Attachments.File&#39;,
                &#39;Task.ParentTask&#39;
            ]
        }
    },


    // config handlers
    updateStudent: function(student) {
        this.getProxy().setExtraParam(&#39;student&#39;, student || null);
        this.dirty = true;
    },

    updateSection: function(section) {
        this.getProxy().setExtraParam(&#39;course_section&#39;, section || null);
        this.dirty = true;
    },


    // member methods
    loadIfDirty: function() {
        if (!this.dirty || this.getStudent() === null || this.getSection() === null) {
            return;
        }

        this.dirty = false;
        this.load();
    }
});</pre>
</body>
</html>

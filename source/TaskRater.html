<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;SlateTasksTeacher.view.TaskRater&#39;, {
    extend: &#39;Slate.cbl.view.modals.RateTask&#39;,
    xtype: &#39;slate-tasks-teacher-taskrater&#39;,


    config: {
        readOnly: null
    },


    // config handlers
    updateTask: function(task) {
        var me = this,
            form = me.down(&#39;slate-modalform&#39;),
            attachmentsField = me.down(&#39;slate-tasks-attachmentsfield&#39;);

        form.down(&#39;[name=Title]&#39;).setValue(task.get(&#39;Title&#39;));
        form.down(&#39;[name=ParentTaskTitle]&#39;).setValue(task.get(&#39;ParentTask&#39;) ? task.get(&#39;ParentTask&#39;).Title : &#39;&#39;);
        form.down(&#39;[name=ExperienceType]&#39;).setValue(task.get(&#39;ExperienceType&#39;));
        form.down(&#39;[name=ExpirationDate]&#39;).setValue(task.get(&#39;ExpirationDate&#39;));

        attachmentsField.setAttachments(task.get(&#39;Attachments&#39;));
        attachmentsField.setReadOnly(true);
    },

    updateStudentTask: function(studentTask) {
        var me = this,
            form = me.down(&#39;slate-modalform&#39;),
            ratingsView = me.down(&#39;slate-ratingview&#39;),
            commentsField = form.down(&#39;slate-commentsfield&#39;),
            submissionsCmp = form.down(&#39;slate-tasks-submissions&#39;),
            groupedSkills = studentTask.getTaskSkillsGroupedByCompetency();

        if (studentTask.get(&#39;DueDate&#39;)) {
            form.down(&#39;[name=DueDate]&#39;).setValue(studentTask.get(&#39;DueDate&#39;));
        }

        form.down(&#39;[name=ExpirationDate]&#39;).setValue(studentTask.get(&#39;ExpirationDate&#39;));

        form.down(&#39;[name=StudentFullName]&#39;).setValue(studentTask.get(&#39;Student&#39;).FirstName + &#39; &#39; + studentTask.get(&#39;Student&#39;).LastName);
        form.down(&#39;#student-attachments&#39;).setAttachments(studentTask.get(&#39;Attachments&#39;));
        commentsField.setRecord(studentTask);
        submissionsCmp.setData(studentTask.get(&#39;Submissions&#39;));
        ratingsView.setData({
            ratings: [7, 8, 9, 10, 11, 12, 0],
            competencies: groupedSkills
        });
    },

    updateReadOnly: function(readOnly) {
        var me = this,
            toolbarBtns = me.query(&#39;container[dock=bottom] button&#39;),
            // attachmentsField = me.down(&#39;slate-tasks-attachmentsfield&#39;),
            reassignField = me.down(&#39;slate-tasks-reassignfield&#39;),
            commentField = me.down(&#39;textareafield&#39;),
            ratingView = me.down(&#39;slate-ratingview&#39;),
            i = 0;

        ratingView.setReadOnly(readOnly);
        commentField.setReadOnly(readOnly);
        reassignField[readOnly ? &#39;hide&#39; : &#39;show&#39;]();
        // attachmentsField.setReadOnly(readOnly); // todo: implement studenttask specific attachments

        for (; i &lt; toolbarBtns.length; i++) {
            toolbarBtns[i].setDisabled(readOnly);
        }
    }
});
</pre>
</body>
</html>

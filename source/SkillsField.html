<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;Slate.cbl.widget.SkillsField&#39;, {
    extend: &#39;Ext.form.FieldContainer&#39;,
    requires: [
        &#39;Slate.cbl.store.Skills&#39;,
        &#39;Ext.form.field.ComboBox&#39;,
        &#39;Ext.view.View&#39;
    ],
    xtype: &#39;slate-skillsfield&#39;,
    config: {
        readOnly: false
    },

    componentCls: &#39;slate-skillsfield&#39;,

    fieldLabel: &#39;Skills&#39;,

    items: [
        {
            width: &#39;100%&#39;,
            xtype: &#39;combo&#39;,
            store: {
                model: &#39;Slate.cbl.model.Skill&#39;,
                autoLoad: true
            },
            queryParam: &#39;q&#39;,
            displayField: &#39;Code_Descriptor&#39;,
            valueField: &#39;ID&#39;,
            emptyText: &#39;Competency code or statement\u2026&#39;, // &amp;hellip;
            hideTrigger: true,
            minChars: 2,
            listeners: {
                beforeselect: function(combo, record) {
                    var field = combo.up(&#39;slate-skillsfield&#39;);

                    field.setSkills(record, true, true); // append, editable
                    return false;
                }
            },
            selectOnTab: false
        },
        {
            xtype: &#39;dataview&#39;,
            itemId: &#39;skills-list&#39;,
            cls: &#39;slate-skillsfield-list&#39;,
            store: {
                model: &#39;Slate.cbl.model.Skill&#39;
            },
            autoEl: &#39;ul&#39;,
            itemSelector: &#39;.slate-skillsfield-item&#39;,
            tpl: [
                &#39;&lt;tpl for=&quot;.&quot;&gt;&#39;,
                    &#39;&lt;li class=&quot;slate-skillsfield-item&quot;&gt;&#39;,
                        &#39;&lt;div class=&quot;slate-skillsfield-token&quot;&gt;&#39;,
                            &#39;&lt;strong class=&quot;slate-skillsfield-item-code&quot;&gt;{Code}&lt;/strong&gt;&#39;,
                            &#39;&lt;span class=&quot;slate-skillsfield-item-title&quot; title=&quot;{Descriptor}&quot;&gt;{Descriptor}&lt;/span&gt;&#39;,
                            &#39;&lt;tpl if=&quot;isEditable&quot;&gt;&#39;,
                                &#39;&lt;i tabindex=&quot;0&quot; class=&quot;slate-skillsfield-item-remove fa fa-times-circle&quot;&gt;&lt;/i&gt;&#39;,
                            &#39;&lt;/tpl&gt;&#39;,
                        &#39;&lt;/div&gt;&#39;,
                    &#39;&lt;/li&gt;&#39;,
                &#39;&lt;/tpl&gt;&#39;
            ],
            prepareData: function(data, recordIndex, record) {
                var recordData = record.getData();

                return recordData;
            },
            listeners: {
                itemclick: function(view, record, item, idx, event) {

                    if (event.target.classList.contains(&#39;slate-skillsfield-item-remove&#39;)) {
                        view.getStore().remove(record);
                    }
                }
            }
        }
    ],

    updateReadOnly: function(readOnly) {
        var me = this,
            field, view;

        if (!me.rendered) {
            me.on(&#39;render&#39;, function() {
                return me.updateReadOnly(readOnly);
            });
            return;
        }

        field = me.down(&#39;combo&#39;);
        view = me.down(&#39;#skills-list&#39;);
        readOnly = Boolean(readOnly);

        view.refreshView();
        field[readOnly ? &#39;hide&#39; : &#39;show&#39;]();
    },

    getSkills: function(returnRecords, idsOnly) {
        var me = this,
            skillsList = me.down(&#39;#skills-list&#39;),
            skillsStore = skillsList.getStore();

        if (returnRecords === false) {
            if (idsOnly === true) {
                return skillsStore.collect(&#39;ID&#39;);
            }
            return Ext.Array.map(skillsStore.getRange(), function(s) {
                return s.getData();
            });
        }
        return skillsStore.getRange();
    },

    setSkills: function(skills, append, editable) {
        var me = this,
            skillsList = me.down(&#39;#skills-list&#39;),
            skillsStore = skillsList.getStore(),
            i = 0,
            setEditable = function(r, e) {
                if (r &amp;&amp; r.isInstance) {
                    r.set(&#39;isEditable&#39;, Boolean(e));
                } else if (r) {
                    r.isEditable = Boolean(e);
                }
            };

        if (append !== true) {
            skillsStore.removeAll();
        }

        if (skills &amp;&amp; typeof skills == &#39;object&#39;) {
            if (Ext.isArray(skills)) {
                for (; i &lt; skills.length; i++) {
                    setEditable(skills[i], editable);
                }
            } else {
                setEditable(skills, editable);
            }
        }
        skillsStore.add(skills);
    }
});</pre>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='SlateTasksTeacher-controller-Dashboard'>/**
</span> * The Dashboard controller manages the main functionality of the SlateTasksTeacher application where teachers can
 * browse, search, create, edit, and assign tasks.
 *
 * ## Responsibilities
 * - Handle section/:sectionId route
 * - Handle CRUD operations for tasks/student tasks
 * - Filter StudentsGrid tasks/students by selected section
 *
 * ## TODO
 * - [X] sort refs by parent
 * - [X] ensure no extra autoCreate refs
 * - [X] match dependencies to controller refs
 * - [X] change route format to &#39;:sectionCode&#39;
 * - [X] mediate state through dashboard view config
 * - [X] drive `setSection`/`sectionchange` and `setCohort`/`cohortchange` state via dashboard view config
 * - [X] drive store and view config from change events in controller
 * - [ ] ensure Navigation &lt;-&gt; State flow
 * - [ ] ensure requires include all and only the views being create within the same file
 * - [ ] Update controller descriptions/responsibilities
 *
 * ## Roadmap
 * - Break out sibling controllers for post-navigation workflows like drive integration, task editing
 */
Ext.define(&#39;SlateTasksTeacher.controller.Dashboard&#39;, {
    extend: &#39;Ext.app.Controller&#39;,


<span id='SlateTasksTeacher-controller-Dashboard-property-views'>    // dependencies
</span>    views: [
        &#39;Dashboard&#39;
    ],

<span id='SlateTasksTeacher-controller-Dashboard-property-stores'>    stores: [
</span>        &#39;Sections@Slate.store.courses&#39;,
        &#39;SectionCohorts@Slate.store.courses&#39;,
        &#39;SectionParticipants&#39;
    ],


<span id='SlateTasksTeacher-controller-Dashboard-property-refs'>    // component factories and selectors
</span>    refs: {
        dashboardCt: {
            selector: &#39;slate-tasks-teacher-dashboard&#39;,
            autoCreate: true,

            xtype: &#39;slate-tasks-teacher-dashboard&#39;
        },
        sectionSelector: &#39;slate-tasks-teacher-appheader slate-section-selector&#39;,
        cohortSelector: &#39;slate-tasks-teacher-appheader slate-cohort-selector&#39;
    },


<span id='SlateTasksTeacher-controller-Dashboard-property-routes'>    // entry points
</span>    routes: {
        &#39;:sectionCode/:cohortName&#39;: {
            action: &#39;showDashboard&#39;,
            conditions: {
                &#39;:sectionCode&#39;: &#39;([^/]+)&#39;,
                &#39;:cohortName&#39;: &#39;([^/]+)&#39;
            }
        }
    },

<span id='SlateTasksTeacher-controller-Dashboard-property-listen'>    listen: {
</span>        store: {
            &#39;#Sections&#39;: {
                load: &#39;onSectionsLoad&#39;
            },
            &#39;#SectionCohorts&#39;: {
                load: &#39;onSectionCohortsLoad&#39;
            }
        }
    },

<span id='SlateTasksTeacher-controller-Dashboard-property-control'>    control: {
</span>        dashboardCt: {
            selectedsectionchange: &#39;onSelectedSectionChange&#39;,
            selectedcohortchange: &#39;onSelectedCohortChange&#39;
        },
        sectionSelector: {
            select: &#39;onSectionSelectorSelect&#39;
        },
        cohortSelector: {
            select: &#39;onCohortSelectorSelect&#39;,
            clear: &#39;onCohortSelectorClear&#39;
        }
    },


<span id='SlateTasksTeacher-controller-Dashboard-method-onLaunch'>    // controller templates method overrides
</span>    onLaunch: function () {
        var sectionsStore = this.getSectionsStore();

        // configure and load sections store for selector
        sectionsStore.getProxy().setExtraParam(&#39;enrolled_user&#39;, &#39;current&#39;);
        sectionsStore.load();

        // render dashboard container to #slateapp-viewport element provided by framing HTML
        this.getDashboardCt().render(&#39;slateapp-viewport&#39;);
    },


<span id='SlateTasksTeacher-controller-Dashboard-method-showDashboard'>    // route handlers
</span>    showDashboard: function(sectionCode, cohortName) {
        var dashboardCt = this.getDashboardCt();

        // use false instead of null, to indicate selecting *nothing* vs having no selection
        dashboardCt.setSelectedSection(sectionCode || false);
        dashboardCt.setSelectedCohort(cohortName &amp;&amp; cohortName != &#39;all&#39; ? this.decodeRouteComponent(cohortName) : false);
    },


<span id='SlateTasksTeacher-controller-Dashboard-method-onSectionsLoad'>    // event handlers
</span>    onSectionsLoad: function(sectionsStore) {
        var dashboardCt = this.getDashboardCt(),
            sectionCode = dashboardCt.getSelectedSection(),
            loadedSection = dashboardCt.getLoadedSection();

        if (!loadedSection || loadedSection.get(&#39;Code&#39;) != sectionCode) {
            dashboardCt.setLoadedSection(sectionsStore.getByCode(sectionCode));
        }
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onSectionCohortsLoad'>    onSectionCohortsLoad: function(store, records, success) {
</span>        if (success) {
            this.getCohortSelector().enable();
        }
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onSelectedSectionChange'>    onSelectedSectionChange: function(dashboardCt, sectionCode) {
</span>        var me = this,
            sectionSelector = me.getSectionSelector(),
            sectionsStore = me.getSectionsStore(),
            cohortsStore = me.getSectionCohortsStore(),
            sectionParticipants = me.getSectionParticipantsStore(),
            section;

        // push value to selector
        sectionSelector.setValue(sectionCode);

        // update loaded section record
        section = sectionsStore.getByCode(sectionCode);

        if (section) {
            dashboardCt.setLoadedSection(section);
        } else {
            sectionsStore.getModel().load(null, {
                url: &#39;/sections/&#39;+encodeURIComponent(sectionCode),
                success: function(loadedSection) {
                    dashboardCt.setLoadedSection(loadedSection);
                }
            });
        }

        // (re)load the cohorts list
        cohortsStore.setSection(sectionCode);
        cohortsStore.loadIfDirty();

        // (re)load participants list
        sectionParticipants.setSection(sectionCode);
        sectionParticipants.loadIfDirty(true);
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onSelectedCohortChange'>    onSelectedCohortChange: function(dashboardCt, cohortName) {
</span>        var sectionParticipants = this.getSectionParticipantsStore();

        // push value to selector
        this.getCohortSelector().setValue(cohortName);

        // filter participants list
        if (cohortName) {
            sectionParticipants.filter(&#39;Cohort&#39;, cohortName);
        } else {
            sectionParticipants.clearFilter();
        }
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onSectionSelectorSelect'>    onSectionSelectorSelect: function(sectionSelector, section) {
</span>        this.redirectTo([section.get(&#39;Code&#39;), &#39;all&#39;]);
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onCohortSelectorSelect'>    onCohortSelectorSelect: function(cohortSelector, cohort) {
</span>        this.redirectTo([this.getDashboardCt().getSelectedSection(), cohort.get(&#39;Cohort&#39;) || &#39;all&#39;]);
    },

<span id='SlateTasksTeacher-controller-Dashboard-method-onCohortSelectorClear'>    onCohortSelectorClear: function() {
</span>        this.redirectTo([this.getDashboardCt().getSelectedSection(), &#39;all&#39;]);
    }
});</pre>
</body>
</html>

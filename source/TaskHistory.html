<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// TODO: move into SlateTasksStudent app
Ext.define(&#39;Slate.cbl.view.student.TaskHistory&#39;, {
    extend: &#39;Slate.cbl.widget.SimplePanel&#39;,
    xtype: &#39;slate-taskhistory&#39;,


    title: &#39;Past English Tasks&#39;,
    cls: &#39;slate-taskhistory&#39;,

    data: {
        tasks: [
            {
                title: &#39;Task title w/o subtasks&#39;,
                // TODO double-check what the colors in design are meant to indicate
                skills: {
                    &#39;on-level&#39;: 4,
                    &#39;off-level&#39;: 2
                },
                date: &#39;June 10&#39;
            },
            {
                title: &#39;Task w/ subtasks&#39;,
                skills: {
                    &#39;on-level&#39;: 3,
                    &#39;off-level&#39;: 1
                },
                date: &#39;June 6&#39;,
                subtasks: [
                    {
                        title: &#39;Subtask lab report&#39;,
                        skills: {
                            &#39;on-level&#39;: 7
                        },
                        date: &#39;June 1&#39;
                    }
                ]
            },
            {
                title: &#39;Task w/ subtasks&#39;,
                skills: {
                    incomplete: 6
                },
                date: &#39;May 27&#39;,
                subtasks: [
                    {
                        title: &#39;Subtask lab report&#39;,
                        skills: {
                            &#39;incomplete&#39;: 6
                        },
                        date: &#39;May 10&#39;
                    }
                ]
            }
        ]
    },

    tpl: [
        &#39;&lt;table class=&quot;slate-taskhistory-table&quot;&gt;&#39;,
            &#39;&lt;thead&gt;&#39;,
                &#39;&lt;tr&gt;&#39;,
                    &#39;&lt;th&gt;Task&lt;/th&gt;&#39;,
                    &#39;&lt;th class=&quot;text-center&quot;&gt;Skills On Level&lt;/th&gt;&#39;,
                    &#39;&lt;th class=&quot;text-center&quot;&gt;Submitted Date&lt;/th&gt;&#39;,
                &#39;&lt;/tr&gt;&#39;,
            &#39;&lt;/thead&gt;&#39;,

            &#39;&lt;tbody&gt;&#39;,
                &#39;&lt;tpl for=&quot;tasks&quot;&gt;&#39;,
                    // TODO wire collapsing
                    &#39;&lt;tr class=&quot;slate-taskhistory-row &lt;tpl if=&quot;subtasks&quot;&gt;is-expandable&lt;/tpl&gt;&quot;&gt;&#39;,
                        &#39;&lt;td class=&quot;slate-taskhistory-cell&quot;&gt;&#39;,
                            &#39;&lt;span class=&quot;slate-taskhistory-taskbullet&quot;&gt;&lt;/span&gt;&#39;,
                            &#39;&lt;span class=&quot;slate-taskhistory-tasktitle&quot;&gt;{title}&lt;/span&gt;&#39;,
                        &#39;&lt;/td&gt;&#39;,

                        &#39;&lt;td class=&quot;slate-taskhistory-cell slate-taskhistory-skills-cell text-center&quot;&gt;&#39;,
                            &#39;&lt;tpl foreach=&quot;skills&quot;&gt;&#39;,
                                &#39;{[ this.printSomeIndicators(values, xkey) ]}&#39;,
                            &#39;&lt;/tpl&gt;&#39;,
                            &#39;&lt;div class=&quot;slate-taskhistory-skills-overlay&quot;&gt;&lt;span class=&quot;slate-taskhistory-skills-caption&quot;&gt;{[ this.printOverlayString(values.skills) ]}&lt;/span&gt;&lt;/div&gt;&#39;,
                        &#39;&lt;/td&gt;&#39;,

                        &#39;&lt;td class=&quot;slate-taskhistory-cell text-center&quot;&gt;&#39;,
                            &#39;{date}&#39;,
                        &#39;&lt;/td&gt;&#39;,
                    &#39;&lt;/tr&gt;&#39;,

                    &#39;&lt;tpl if=&quot;subtasks&quot;&gt;&#39;,
                        &#39;&lt;tr class=&quot;slate-taskhistory-row&quot;&gt;&#39;,
                            &#39;&lt;td class=&quot;slate-taskhistory-subrow-cell&quot; colspan=&quot;3&quot;&gt;&#39;,
                                &#39;&lt;div class=&quot;slate-taskhistory-subrow-ct&quot;&gt;&#39;,
                                    &#39;&lt;table class=&quot;slate-taskhistory-subrow-table&quot;&gt;&#39;,
                                        &#39;&lt;tbody&gt;&#39;,
                                            &#39;&lt;tpl foreach=&quot;subtasks&quot;&gt;&#39;,
                                                &#39;&lt;tr class=&quot;slate-taskhistory-subrow &lt;tpl if=&quot;subtasks&quot;&gt;&lt;tpl else&gt;is-standalone&lt;/tpl&gt;&quot;&gt;&#39;,
                                                    &#39;&lt;td class=&quot;slate-taskhistory-cell&quot;&gt;&#39;,
                                                        &#39;&lt;span class=&quot;slate-taskhistory-taskbullet&quot;&gt;&lt;/span&gt;&#39;,
                                                        &#39;&lt;span class=&quot;slate-taskhistory-tasktitle&quot;&gt;{title}&lt;/span&gt;&#39;,
                                                    &#39;&lt;/td&gt;&#39;,

                                                    &#39;&lt;td class=&quot;slate-taskhistory-cell slate-taskhistory-skills-cell text-center&quot;&gt;&#39;,
                                                        &#39;&lt;tpl foreach=&quot;skills&quot;&gt;&#39;,
                                                            &#39;{[ this.printSomeIndicators(values, xkey) ]}&#39;,
                                                        &#39;&lt;/tpl&gt;&#39;,
                                                        &#39;&lt;div class=&quot;slate-taskhistory-skills-overlay&quot;&gt;&lt;span class=&quot;slate-taskhistory-skills-caption&quot;&gt;{[ this.printOverlayString(values.skills) ]}&lt;/span&gt;&lt;/div&gt;&#39;,
                                                    &#39;&lt;/td&gt;&#39;,

                                                    &#39;&lt;td class=&quot;slate-taskhistory-cell text-center&quot;&gt;&#39;,
                                                        &#39;{date}&#39;,
                                                    &#39;&lt;/td&gt;&#39;,
                                                &#39;&lt;/tr&gt;&#39;,
                                            &#39;&lt;/tpl&gt;&#39;,
                                        &#39;&lt;/tbody&gt;&#39;,
                                    &#39;&lt;/table&gt;&#39;,
                                &#39;&lt;/div&gt;&#39;,
                            &#39;&lt;/td&gt;&#39;,
                        &#39;&lt;/tr&gt;&#39;,
                    &#39;&lt;/tpl&gt;&#39;,
                &#39;&lt;/tpl&gt;&#39;,
            &#39;&lt;/tbody&gt;&#39;,
        &#39;&lt;/table&gt;&#39;,

        {
            printSomeIndicators: function(n, status) {
                var i = 0,
                    html = &#39;&#39;;

                for (; i &lt; n; i++) {
                    html += &#39;&lt;span class=&quot;slate-taskhistory-skillindicator status-&#39; + status + &#39;&quot;&gt;&lt;i class=&quot;fa fa-check&quot;&gt;&lt;/i&gt;&lt;/span&gt; &#39;;
                }

                return html;
            },

            printOverlayString: function(skills) {
                var on          = skills[&#39;on-level&#39;] || 0,
                    off         = skills[&#39;off-level&#39;] || 0,
                    incomplete  = skills[&#39;incomplete&#39;] || 0,
                    total       = on + off + incomplete,
                    html        = &#39;&#39;;

                if (on || off) {
                    html += on + &#39;/&#39; + total + &#39; on level&#39;;
                }

                if (incomplete &amp;&amp; (on || off)) {
                    html += &#39;, &#39;;
                }

                if (incomplete) {
                    html += incomplete + &#39;/&#39; + total + &#39; incomplete&#39;
                }

                return html;
            }
        }
    ],

    listeners: {
        scope: &#39;this&#39;,
        click: {
            fn: &#39;onExpandClick&#39;,
            element: &#39;el&#39;,
            delegate: &#39;.is-expandable .slate-taskhistory-taskbullet&#39;
        }
    },

    onExpandClick: function(ev, t) {
        var target = Ext.get(t),
            row;

        if (target.is(&#39;.slate-taskhistory-taskbullet&#39;)) {
            row = target.up(&#39;.slate-taskhistory-row&#39;);

            row.toggleCls(&#39;is-expanded&#39;);
        }
    }
});</pre>
</body>
</html>

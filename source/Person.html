<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;Slate.model.person.Person&#39;, {
    extend: &#39;Ext.data.Model&#39;,
    requires: [
        &#39;Slate.proxy.people.People&#39;,
        &#39;Ext.data.identifier.Negative&#39;,
        &#39;Ext.data.validator.Presence&#39;
    ],


    // model config
    idProperty: &#39;ID&#39;,
    identifier: &#39;negative&#39;,

    fields: [
        // person fields
        {
            name: &#39;ID&#39;,
            type: &#39;integer&#39;
        },
        {
            name: &#39;Class&#39;,
            defaultValue: &#39;Emergence\\People\\Person&#39;
        },
        {
            name: &#39;Created&#39;,
            type: &#39;date&#39;,
            dateFormat: &#39;timestamp&#39;,
            allowNull: true
        },
        {
            name: &#39;CreatorID&#39;,
            type: &#39;integer&#39;,
            allowNull: true
        },
        {
            name: &#39;PrimaryPhotoID&#39;,
            type: &#39;integer&#39;,
            allowNull: true
        },
        &#39;PrimaryPhoto&#39;,
        {
            name: &#39;PrimaryEmailID&#39;,
            type: &#39;integer&#39;,
            allowNull: true
        },
        &#39;PrimaryEmail&#39;,
        {
            name: &#39;PrimaryPhoneID&#39;,
            type: &#39;integer&#39;,
            allowNull: true
        },
        &#39;PrimaryPhone&#39;,
        {
            name: &#39;PrimaryPostalID&#39;,
            type: &#39;integer&#39;,
            allowNull: true
        },
        &#39;PrimaryPostal&#39;,
        {
            name: &#39;FirstName&#39;,
            defaultValue: null
        },
        {
            name: &#39;LastName&#39;,
            defaultValue: null
        },
        {
            name: &#39;MiddleName&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;PreferredName&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;FullName&#39;,
            persist: false,
            depends: [&#39;FirstName&#39;, &#39;LastName&#39;],
            convert: function(v, r) {
                return Ext.Array.clean([
                    r.get(&#39;FirstName&#39;),
                    r.get(&#39;LastName&#39;)
                ]).join(&#39; &#39;);
            }
        },
        {
            name: &#39;PreferredFullName&#39;,
            persist: false,
            depends: [&#39;PreferredName&#39;, &#39;FirstName&#39;, &#39;LastName&#39;],
            convert: function(v, r) {
                return Ext.Array.clean([
                    r.get(&#39;PreferredName&#39;) || r.get(&#39;FirstName&#39;),
                    r.get(&#39;LastName&#39;)
                ]).join(&#39; &#39;);
            }
        },
        {
            name: &#39;SortName&#39;,
            persist: false,
            depends: [&#39;FirstName&#39;, &#39;LastName&#39;],
            convert: function(v, r) {
                return r.get(&#39;LastName&#39;) + &#39;, &#39; + r.get(&#39;FirstName&#39;);
            }
        },
        {
            name: &#39;Email&#39;,
            depends: [&#39;PrimaryEmail&#39;],
            convert: function(v, r) {
                var pointData = r.get(&#39;PrimaryEmail&#39;);

                return pointData ? pointData.Data : null;
            }
        },
        {
            name: &#39;Gender&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;BirthDate&#39;,
            type: &#39;date&#39;,
            dateFormat: &#39;Y-m-d&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;About&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;Location&#39;,
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;groupIDs&#39;,
            allowNull: true,
            defaultValue: null
        },


        // user fields
        {
            name: &#39;Username&#39;,
            classes: [
                &#39;Emergence\\People\\User&#39;,
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;AccountLevel&#39;,
            classes: [
                &#39;Emergence\\People\\User&#39;,
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;TemporaryPassword&#39;,
            classes: [
                &#39;Emergence\\People\\User&#39;,
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null
        },


        // student fields
        {
            name: &#39;StudentNumber&#39;,
            classes: [
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;Advisor&#39;,
            classes: [
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null,
            sortType: function(v) {
                return v ? v.LastName : &#39;_&#39;;
            }
        },
        {
            name: &#39;AdvisorID&#39;,
            classes: [
                &#39;Slate\\People\\Student&#39;
            ],
            allowNull: true,
            defaultValue: null
        },
        {
            name: &#39;GraduationYear&#39;,
            classes: [
                &#39;Slate\\People\\Student&#39;
            ],
            type: &#39;integer&#39;,
            allowNull: true,
            defaultValue: null
        }
    ],

    validators: {
        FirstName: &#39;presence&#39;,
        LastName: &#39;presence&#39;
    },

    proxy: &#39;slate-people&#39;,


    // model methods
    getFullName: function() {
        return this.get(&#39;FullName&#39;);
    },

    getDisplayName: function() {
        var me = this,
            firstName = me.get(&#39;FirstName&#39;),
            lastName = me.get(&#39;LastName&#39;),
            email = me.get(&#39;Email&#39;),
            id = me.get(&#39;ID&#39;);

        if (firstName &amp;&amp; lastName) {
            return firstName + &#39; &#39;+ lastName;
        } else if (firstName) {
            return firstName;
        } else if (email) {
            return email;
        }

        return &#39;Person #&#39;+id;
    },

    getLink: function() {
        var me = this,
            displayName = me.getDisplayName(),
            url = me.toUrl();

        return url ? &#39;&lt;a href=&quot;#&#39;+url+&#39;&quot;&gt;&#39;+displayName+&#39;&lt;/a&gt;&#39; : displayName;
    },

    // TODO: move this to a SlateAdmin override
    toUrl: function() {
        var me = this;

        // TODO: append /profile via route rewriter in controller
        if (me.phantom) {
            return null;
        } else if (me.get(&#39;Username&#39;)) {
            return &#39;people/lookup/&#39;+me.get(&#39;Username&#39;)+&#39;/profile&#39;;
        }

        return &#39;people/lookup/?id=&#39;+me.get(&#39;ID&#39;)+&#39;/profile&#39;;
    }
});

</pre>
</body>
</html>

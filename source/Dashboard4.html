<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='SlateDemonstrationsTeacher-controller-Dashboard'>/**
</span> * TODO:
 * - move rendering responsibilities to the view?
 */
Ext.define(&#39;SlateDemonstrationsTeacher.controller.Dashboard&#39;, {
    extend: &#39;Ext.app.Controller&#39;,
    requires: [
        &#39;Jarvus.util.APIDomain&#39;,

        &#39;Slate.API&#39;,

        &#39;Ext.window.MessageBox&#39;
    ],


<span id='SlateDemonstrationsTeacher-controller-Dashboard-property-listen'>    // entry points
</span>    listen: {
        api: {
            demonstrationsave: &#39;onDemonstrationSave&#39;,
            demonstrationdelete: &#39;onDemonstrationDelete&#39;
        }
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-property-control'>    control: {
</span>        studentProgressGrid: {
            competencyrowclick: &#39;onCompetencyRowClick&#39;,
            democellclick: &#39;onDemoCellClick&#39;
        },
        &#39;slate-demonstrations-teacher-skill-overviewwindow&#39;: {
            createdemonstrationclick: &#39;onOverviewCreateDemonstrationClick&#39;,
            editdemonstrationclick: &#39;onOverviewEditDemonstrationClick&#39;,
            deletedemonstrationclick: &#39;onOverviewDeleteDemonstrationClick&#39;,
            createoverrideclick: &#39;onOverviewCreateOverrideClick&#39;
        }
    },


<span id='SlateDemonstrationsTeacher-controller-Dashboard-property-views'>    // controller configuration
</span>    views: [
        &#39;Dashboard&#39;,
        &#39;OverviewWindow&#39;,
        &#39;OverrideWindow&#39;,
        &#39;EditWindow&#39;
    ],

<span id='SlateDemonstrationsTeacher-controller-Dashboard-property-models'>    models: [
</span>        &#39;Demonstration@Slate.cbl.model&#39;
    ],

<span id='SlateDemonstrationsTeacher-controller-Dashboard-property-refs'>    refs: {
</span>        dashboardCt: {
            selector: &#39;slate-demonstrations-teacher-dashboard&#39;,
            autoCreate: true,

            xtype: &#39;slate-demonstrations-teacher-dashboard&#39;
        },
        studentProgressGrid: &#39;slate-demonstrations-teacher-dashboard slate-demonstrations-teacher-studentsprogressgrid&#39;
    },


<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onLaunch'>    // controller templates method overrides
</span>    onLaunch: function () {
        var me = this,
            siteEnv = window.SiteEnvironment || {},
            contentAreaCode = (siteEnv.cblContentArea || {}).Code,
            dashboardCt = me.getDashboardCt(),
            progressGrid = dashboardCt.getProgressGrid();

        // configure dashboard with any available embedded data
        if (contentAreaCode) {
            progressGrid.setStudentDashboardLink(&#39;/cbl/student-dashboard?content-area=&#39; + encodeURIComponent(contentAreaCode));
        }

        if (siteEnv.cblStudents) {
            progressGrid.getStudentsStore().loadData(siteEnv.cblStudents);
        }

        if (siteEnv.cblCompetencies) {
            progressGrid.getCompetenciesStore().loadData(siteEnv.cblCompetencies);
        }

        // handle any external &quot;Log a Demonstartion&quot; buttons
        Ext.getBody().on(&#39;click&#39;, function(ev) {
            ev.stopEvent();

            me.showDemonstrationEditWindow();
        }, me, { delegate: &#39;button[data-action=&quot;demonstration-create&quot;]&#39; });

        // render dashboard
        dashboardCt.render(&#39;slateapp-viewport&#39;);
    },


<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onCompetencyRowClick'>    // event handers
</span>    onCompetencyRowClick: function(me, competency, ev, targetEl) {
        me.toggleCompetency(competency);
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onDemoCellClick'>    onDemoCellClick: function(progressGrid, ev, targetEl) {
</span>        this.getOverviewWindowView().create({
            ownerCmp: this.getDashboardCt(),
            autoShow: true,
            animateTarget: targetEl,

            competency: parseInt(targetEl.up(&#39;.cbl-grid-skills-row&#39;).getAttribute(&#39;data-competency&#39;), 10),
            studentsStore: progressGrid.getStudentsStore(),
            competenciesStore: progressGrid.getCompetenciesStore(),

            skill: parseInt(targetEl.up(&#39;.cbl-grid-skill-row&#39;).getAttribute(&#39;data-skill&#39;), 10),
            student: parseInt(targetEl.up(&#39;.cbl-grid-demos-cell&#39;).getAttribute(&#39;data-student&#39;), 10),
            selectedDemonstration: parseInt(targetEl.getAttribute(&#39;data-demonstration&#39;), 10)
        });
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onOverviewCreateDemonstrationClick'>    onOverviewCreateDemonstrationClick: function(overviewWindow, student, competency) {
</span>        this.showDemonstrationEditWindow({
            defaultStudent: student,
            defaultCompetency: competency
        });
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onOverviewEditDemonstrationClick'>    onOverviewEditDemonstrationClick: function(overviewWindow, demonstrationId) {
</span>        var me = this,
            editWindow = me.showDemonstrationEditWindow({
                title: &#39;Edit demonstration #&#39; + demonstrationId
            });

        editWindow.setLoading(&#39;Loading demonstration #&#39; + demonstrationId + &#39;&amp;hellip;&#39;);
        Slate.cbl.model.Demonstration.load(demonstrationId, {
            params: {
                include: &#39;Skills.Skill&#39;
            },
            success: function(demonstration) {
                editWindow.setDemonstration(demonstration);
                editWindow.setLoading(false);
            }
        });
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onOverviewDeleteDemonstrationClick'>    onOverviewDeleteDemonstrationClick: function(overviewWindow, demonstrationId) {
</span>        overviewWindow.setLoading(&#39;Loading demonstration #&#39; + demonstrationId + &#39;&amp;hellip;&#39;);

        Slate.cbl.model.Demonstration.load(demonstrationId, {
            params: {
                include: &#39;Skills.Skill&#39;
            },
            success: function(demonstration) {
                Ext.Msg.confirm(
                    &#39;Delete demonstration #&#39; + demonstrationId,
                    &#39;Are you sure you want to permenantly delete this demonstration?&#39; +
                        &#39; Scores in all the following standards will be removed:&#39; +
                        &#39;&lt;ul&gt;&#39; +
                            &#39;&lt;li&gt;&#39; +
                            Ext.Array.map(demonstration.get(&#39;Skills&#39;), function(demoSkill) {
                                return &#39;&lt;strong&gt;Level &#39; + demoSkill.DemonstratedLevel + &#39;&lt;/strong&gt; demonstrated in &lt;strong&gt;&#39; + demoSkill.Skill.Code + &#39;&lt;/strong&gt;: &lt;em&gt;&#39; + demoSkill.Skill.Statement + &#39;&lt;/em&gt;&#39;;
                            }).join(&#39;&lt;/li&gt;&lt;li&gt;&#39;) +
                            &#39;&lt;/li&gt;&#39; +
                        &#39;&lt;/ul&gt;&#39;,
                    function(btnId) {
                        if (btnId != &#39;yes&#39;) {
                            overviewWindow.setLoading(false);
                            return;
                        }

                        demonstration.erase({
                            params: {
                                include: &#39;competencyCompletions&#39;
                            },
                            success: function(demonstration, operation) {
                                Slate.API.fireEvent(&#39;demonstrationdelete&#39;, operation.getResultSet().getRecords()[0]);
                                overviewWindow.setLoading(false);
                            }
                        });
                    }
                );
            }
        });
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onOverviewCreateOverrideClick'>    onOverviewCreateOverrideClick: function(overviewWindow, studentId, standardId) {
</span>        this.getOverrideWindowView().create({
            ownerCmp: this.getDashboardCt(),
            autoShow: true,

            student: studentId,
            standard: standardId
        });
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onDemonstrationSave'>    onDemonstrationSave: function(demonstration) {
</span>        this.getDashboardCt().progressGrid.loadDemonstration(demonstration);
    },

<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-onDemonstrationDelete'>    onDemonstrationDelete: function(demonstration) {
</span>        this.getDashboardCt().progressGrid.deleteDemonstration(demonstration);
    },


<span id='SlateDemonstrationsTeacher-controller-Dashboard-method-showDemonstrationEditWindow'>    // public methods
</span>    showDemonstrationEditWindow: function(options) {
        var dashboardCt = this.getDashboardCt();

        return this.getEditWindowView().create(Ext.apply({
            ownerCmp: dashboardCt,
            autoShow: true,

            studentsStore: dashboardCt.progressGrid.getStudentsStore()
        }, options));
    }
});</pre>
</body>
</html>

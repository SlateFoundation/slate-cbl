<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*jslint browser: true, undef: true *//*global Ext*/
Ext.define(&#39;SlateDemonstrationsTeacher.view.EditWindow&#39;, {
    extend: &#39;Ext.window.Window&#39;,
    xtype: &#39;slate-demonstrations-teacher-demonstration-editwindow&#39;,
    requires: [
        &#39;SlateDemonstrationsTeacher.view.EditWindowController&#39;,
        &#39;SlateDemonstrationsTeacher.view.CompetencyCard&#39;,

        &#39;Slate.cbl.data.ContentAreas&#39;,
        &#39;Slate.cbl.data.Competencies&#39;,
        &#39;Slate.cbl.model.Demonstration&#39;,

        &#39;Ext.layout.container.Fit&#39;,
        &#39;Ext.form.Panel&#39;,
        &#39;Ext.tab.Panel&#39;,
        &#39;Ext.grid.Panel&#39;,
        &#39;Ext.grid.feature.Grouping&#39;,
        &#39;Ext.grid.column.Action&#39;,
        &#39;Ext.form.field.Text&#39;,
        &#39;Ext.form.field.TextArea&#39;,
        &#39;Ext.form.field.ComboBox&#39;,
        &#39;Ext.form.field.Checkbox&#39;,
        &#39;Ext.form.field.Date&#39;,
        &#39;Ext.data.ChainedStore&#39;
    ],

    controller: &#39;slate-demonstrations-teacher-demonstration-editwindow&#39;,

    config: {
        demonstration: {
            Class: &#39;Slate\\CBL\\Demonstrations\\ExperienceDemonstration&#39;
        },
        studentsStore: null,
        defaultStudent: null,
        defaultCompetency: null
    },

    title: &#39;Submit Evidence&#39;,
    width: 600,
    constrainHeader: true,

//    tools: [
//        {
//            type: &#39;gear&#39;,
//            tooltip: &#39;Override&#39;
//        }
//    ],

    layout: &#39;fit&#39;,
    items: {
        reference: &#39;form&#39;,

        xtype: &#39;form&#39;,
        trackResetOnLoad: true,
        autoScroll: true,
        bodyPadding: 16,
        defaults: {
            anchor: &#39;100%&#39;,
            allowBlank: false,
            msgTarget: &#39;side&#39;,
            selectOnFocus: true,
            labelAlign: &#39;right&#39;,
            labelWidth: 150
        },
        items: [
            {
                anchor: &#39;75%&#39;,
                reference: &#39;studentCombo&#39;,

                xtype: &#39;combobox&#39;,
                name: &#39;StudentID&#39;,
                fieldLabel: &#39;Student&#39;,

                store: {
                    type: &#39;chained&#39;
//                    source: &#39;cbl-students-loaded&#39;
                },
                queryMode: &#39;local&#39;,
                displayField: &#39;FullName&#39;,
                valueField: &#39;ID&#39;,

                forceSelection: true,
                autoSelect: true
            },
            {
                anchor: &#39;50%&#39;,
                xtype: &#39;datefield&#39;,
                name: &#39;Demonstrated&#39;,
                fieldLabel: &#39;Demonstrated&#39;,
                displayField: &#39;Demonstrated&#39;,
                valueField: &#39;Demonstrated&#39;,
                value: new Date().toLocaleDateString()
            },

            {
                xtype: &#39;combobox&#39;,
                name: &#39;ExperienceType&#39;,
                fieldLabel: &#39;Type of Experience&#39;,

                store: (window.SiteEnvironment &amp;&amp; window.SiteEnvironment.cblExperienceTypeOptions) || []
            },
            {
                xtype: &#39;combobox&#39;,
                name: &#39;Context&#39;,
                fieldLabel: &#39;Name of Experience&#39;,

                store: (window.SiteEnvironment &amp;&amp; window.SiteEnvironment.cblContextOptions) || []
            },
            {
                xtype: &#39;combobox&#39;,
                name: &#39;PerformanceType&#39;,
                fieldLabel: &#39;Performance Task&#39;,

                store: (window.SiteEnvironment &amp;&amp; window.SiteEnvironment.cblPerformanceTypeOptions) || []
            },
            {
                xtype: &#39;textfield&#39;,
                name: &#39;ArtifactURL&#39;,
                fieldLabel: &#39;Artifact (URL)&#39;,

                allowBlank: true,
                regex: /^https?:\/\/.+/i,
                regexText: &#39;Artifact must be a complete URL (starting with http:// or https://)&#39;
            },
            {
                reference: &#39;competenciesTabPanel&#39;,
                anchor: &#39;100%&#39;,

//              competencyTipTitleTpl: &#39;{Descriptor}&#39;,
//              competencyTipBodyTpl: &#39;{Statement}&#39;,

                xtype: &#39;tabpanel&#39;,
                tabBar: {
                    hidden: true
                },
                margin: &#39;10 -16&#39;,
//                bodyPadding: &#39;16 75&#39;,
                bodyStyle: {
                    backgroundColor: &#39;#ddd&#39;
                },
                // title: &#39;Competencies&#39;,
                defaultType: &#39;slate-demonstrations-teacher-demonstration-competencycard&#39;,
                defaults: {
                    closable: true
                },
                items: [
                    {
                        reference: &#39;competenciesGrid&#39;,
                        title: &#39;Add competency&#39;,
                        glyph: 0xf0fe + &#39;@FontAwesome&#39;,
                        closable: false,

                        xtype: &#39;gridpanel&#39;,
                        height: 300,
                        hideHeaders: true,
                        viewConfig: {
                            emptyText: &#39;No competencies match your search.&#39;,
                            loadingText: false,
                            stripeRows: false
                        },
                        store: {
                            type: &#39;chained&#39;,
                            source: &#39;cbl-competencies&#39;,
                            groupField: &#39;ContentAreaID&#39;
                        },
                        columns: [
                            {
                                text: &#39;Code&#39;,
                                dataIndex: &#39;Code&#39;
                            },
                            {
                                text: &#39;Descriptor&#39;,
                                dataIndex: &#39;Descriptor&#39;,
                                flex: 1
/*
                            },
                            {
                                xtype: &#39;actioncolumn&#39;,
                                width: 40,
                                items: [
                                    {
                                        action: &#39;add&#39;,
                                        glyph: 0xf0fe + &#39;@FontAwesome&#39;,
                                        tooltip: &#39;Add competency to this demonstration&#39;
                                    }
                                ]
*/
                            }
                        ],
                        features: [
                            {
                                id: &#39;grouping&#39;,
                                ftype: &#39;grouping&#39;,
                                groupHeaderTpl: [
                                    &#39;&lt;tpl for=&quot;this.getContentAreaData(values.groupValue)&quot;&gt;&#39;,
                                        &#39;&lt;span class=&quot;title&quot;&gt;{Title}&lt;/span&gt;&#39;,
//                                        &#39;&lt;span class=&quot;count&quot;&gt;{[parent.children.length]}&lt;/span&gt;&#39;,
                                    &#39;&lt;/tpl&gt;&#39;,
                                    {
                                        getContentAreaData: function(contentAreaId) {
                                            return Slate.cbl.data.ContentAreas.getById(contentAreaId).getData();
                                        }
                                    }
                                ],
                                enableGroupingMenu: false,
                                startCollapsed: true
                            }
                        ],
                        dockedItems: [
                            {
                                reference: &#39;competenciesSearchField&#39;,
                                dock: &#39;top&#39;,

                                xtype: &#39;textfield&#39;,
                                margin: &#39;6 12&#39;,
                                emptyText: &#39;Type competency code or statement&amp;hellip;&#39;
                            }
                        ]
                    }
                ]
            },
            {
                anchor: &#39;-59&#39;, // add &quot; -350&quot; to make stretch with window
                xtype: &#39;textarea&#39;,
                name: &#39;Comments&#39;,
                fieldLabel: &#39;Comments&#39;,

                allowBlank: true,
                selectOnFocus: false
            },
            {
                anchor: &#39;100%&#39;,

                xtype: &#39;container&#39;,
                layout: {
                    type: &#39;hbox&#39;,
                    align: &#39;center&#39;
                },
                items: [
                    {
                        xtype: &#39;button&#39;,
                        text: &#39;Submit&#39;,
                        scale: &#39;large&#39;,
                        action: &#39;submit&#39;,
                        formBind: true,
                        margin: &#39;0 16 0 155&#39;
                    },
                    {
                        reference: &#39;loadNextStudentCheck&#39;,

                        xtype: &#39;checkboxfield&#39;,
                        boxLabel: &#39;Continue with next student&#39;
                    }
                ]
            }
        ]
    },

    applyDemonstration: function(demonstration) {
        return Ext.factory(demonstration, &#39;Slate.cbl.model.Demonstration&#39;);
    },

    updateDemonstration: function(demonstration) {
        var me = this,
            _fireEvent = function() {
                me.fireEvent(&#39;loaddemonstration&#39;, me, demonstration);
            };

        // if component is not rendered yet, defer until it is
        if (me.rendered) {
            _fireEvent();
        } else {
            me.on(&#39;render&#39;, _fireEvent, me, { single: true });
        }
    },

    initComponent: function() {
        var me = this,
            studentCombo;

        me.callParent(arguments);

        studentCombo = me.lookupReference(&#39;studentCombo&#39;);
        studentCombo.getStore().setSource(me.getStudentsStore());
        studentCombo.setValue(me.getDefaultStudent());
    }
});</pre>
</body>
</html>
